box: phusion/passenger-ruby22
dev:
  steps:
    - bundle-install
    - internal/watch:
        code: |
          bundle exec thin -R config.ru -p 8080 start
        reload: true
build:
    steps:
        - script:
            name: os
            code: |
              uname -a
              mount
        - script:
            name: install ansible
            code: |
              apt-get update
              apt-get install python-pip -y --no-install-recommends
              pip install ansible
        - script:
            name: ansible
            code: |
              echo "[local]" > hosts
              echo "127.0.0.1" >> hosts
              ansible -i hosts -m setup all
        - script:
            name: install docker
            code: |
              curl -sS https://get.docker.com | sh
              service docker start
        - script:
            name: show processes
            code: ps -ef fw
        - script:
            name: inspect env
            code: export -p
        - script:
            name: show commands
            code: ls /bin /usr/bin /usr/local/bin /sbin /usr/sbin /usr/local/sbin
        - bundle-install
        - script:
            name: rspec
            code: bundle exec rspec
