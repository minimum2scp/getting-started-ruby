box: phusion/passenger-ruby22
dev:
  steps:
    - bundle-install
    - internal/watch:
        code: |
          bundle exec thin -R config.ru -p 8080 start
        reload: true
build:
    steps:
        - script:
            name: container info
            code: |
              hostname
              ip a show dev eth0
        - script:
            name: inspect env
            code: export -p
        - minimum2scp/install-docker@0.1.0
        - script:
            name: docker info
            code: |
              export DOCKER_HOST=tcp://172.17.42.1:2375
              docker info
              docker version
              docker ps -a
              docker inspect -f "{{.NetworkSettings.IPAddress}}	{{.Config.Hostname}}	#{{.Name}}	({{.Config.Image}})" $(docker ps -q)
              docker inspect $(docker ps -a -q)
        - bundle-install
        - script:
            name: rspec
            code: bundle exec rspec

